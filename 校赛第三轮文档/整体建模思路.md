# 林火蔓延建模方案

### 一、 总体设计哲学：

**以物理机理为骨架，以动态过程为血肉，以计算机模拟为手段，构建一个能够解释现象、解决问题的统一模型。**

我们不搞机器学习那种没法解释的“黑箱”，也不搞纯数学公式那种脱离现实的“象牙塔”。我们要建的是一个**基于元胞自动机（CA）的、多层、动态、三维向量化的物理仿真系统**。

### 二、 模型核心框架：多层动态元胞自动机 (Multi-Layer Dynamic CA)

忘掉你之前想的那些平面地图。我们的模拟世界是一块“千层蛋糕”，**至少包含两层**：

1. **地表层 (Surface Layer)**：这是模型的基础，一个紧贴真实地表的、由元胞组成的曲面。它负责模拟地表火的发生和蔓延。
2. **树冠层 (Canopy Layer)**：一个悬浮在地表层之上的虚拟层面，与地表层一一对应。它负责模拟火势跃升成树冠火后的高速蔓延。

### 三、 工程实现细节：拧紧每个零件

这是整个方案最核心的部分。每个细节都决定了你模型的成败。

#### **A. 元胞定义：给你的士兵穿上盔甲**

每个元胞（Cell）不再是一个只有“燃烧/不燃烧”的傻瓜状态。它是一个包含丰富信息的**特征向量**：

- **静态属性 (Static Attributes)**：模型开始前一次性算好，不再改变。
  - `ID`: 唯一标识符。
  - `Position (P)`: **三维空间坐标向量 `(x, y, z)`**。x, y是地理坐标，z是海拔（从DEM数据读取）。这是所有三维计算的基础！
  - `Slope (φ)`: 所在位置的坡度（由DEM计算）。
  - `Aspect`: 所在位置的坡向（由DEM计算）。
  - FuelType ($K_s$): 可燃物类型。对于题目，可以假设为常数“松树”，对应王正非模型里的一个K_s值。
- **动态属性 (Dynamic Attributes)**：在模拟过程中随时都在变化。
  - `State`: 元胞当前状态。枚举类型：`UNBURNED` (0), `SURFACE_FIRE` (1), `CROWN_FIRE` (2), `BURNED_OUT` (3)。
  - FuelLoad ($W$): 当前剩余可燃物载量（公斤/平方米）。初始值可以设为常数。
  - `MoistureContent (M)`: 当前可燃物含水量（%）。
  - `Energy (E)`: 当前元胞吸收到的热量。

#### **B. 核心物理引擎：动态蔓延速度公式** 

这不再是王正非那个简单的静态公式，而是一个考虑了所有动态因素的、用于计算从燃烧元胞 `i` 到邻居元胞 `j` 蔓延速度 $R_{i→j}$ 的**统一物理引擎**：
$$
R_{i\to j}=R_0\cdot K_{\mathrm{wind}}(V_w,\alpha_{ij})\cdot K_s\cdot K_m(M_j)\cdot\Phi(\phi_{ij})
$$

- $R_0$ **(基础蔓延速度)**: 设定一个基准值（米/分钟）。

- $K_s$ **(可燃物系数)**: 根据题目设为松树对应的常数。

- $\Phi$($\phi_{ij}$) **(高级坡度效应因子)**:

  - **计算**：$\phi_{ij}$ 是从元胞 `i` 到 `j` 的局部坡度。
  - **公式**：放弃 $1/cos\phi$ 改用更能反映物理现实的指数形式：$\Phi(\phi)=e^{a \cdot \phi}$ (a是可调参数，$\phi$以弧度计)。

- $K_m(M_j)$ **(动态湿度因子)**:

  - **计算**：$M_j$ 是目标元胞 `j` 的当前含水量。
  - **公式**：$K_m(M_j)=e^{−bM_j}$ (b是可调参数)。湿度越高，抑制作用越强。

- $K_\text{wind}(V_w,\alpha_{ij})$ **(三维风效应因子)**:

  - **计算**：这是核心！

    1. 定义全局风向量 `V_wind = (风速_x, 风速_y, 0)` (假设风是水平的)。
    2. 定义蔓延方向向量 `V_spread = P_j - P_i = (Δx, Δy, Δz)`。
    3. 用向量点积计算相对风向角 $\alpha_{ij}$。

    $$
    \cos(\alpha_{ij})=\frac{\vec{V}_{\mathrm{wind}}\cdot\vec{V}_{\mathrm{spread}}}{|\vec{V}_{\mathrm{wind}}|\cdot|\vec{V}_{\mathrm{spread}}|}
    $$

  - **公式**：$K_\text{wind}=(1+c \cdot V_{w}^d) \cdot f_{dir}(\alpha_{ij})$。其中第一部分是风速大小的影响（c, d为可调参数），第二部分$ f_{dir}(\alpha_{ij})$ 是风向的影响，例如 $f_{dir}(\alpha)=e^{k(cos(\alpha)−1)}$。

#### **C. 模拟演化规则：让你的世界动起来！**

我们采用离散时间步 `Δt` (例如，1分钟)进行迭代。

1. **能量传递与点燃 (Energy Transfer & Ignition)**:
   - 一个`SURFACE_FIRE`状态的元胞 `i` 会向其所有邻居 `j` 传递能量。
   - 邻居 `j` 在 `t+Δt` 时刻吸收到的能量增量为：$\Delta E_j=\frac{C\cdot W_i \cdot R_{i\to j}}{D_{ij}^2} \cdot \Delta t$ (C是常数, $D_{ij}$是i和j的三维空间距离)。
   - **点燃规则**: 如果元胞 `j` 的累计能量 $E_j$ 超过了其燃点阈值 `Ignition_Threshold(M_j)` (该阈值与含水量有关)，则在下一时刻，`j` 的状态变为 `SURFACE_FIRE`。
2. **燃料消耗与熄灭 (Fuel Depletion & Burnout)**:
   - 一个燃烧的元胞 `i` (地表火或树冠火) 会消耗燃料：$W_i(t+ \Delta t)=W_i(t)−\text{BurnRate} \cdot \Delta t$。
   - **熄灭规则**: 当 $W_i \le 0$ 时，元胞 `i` 的状态变为 `BURNED_OUT`。
3. **湿度动态变化 (Moisture Dynamics)**:
   - 一个未燃烧的元胞 `j` 会被周围燃烧的元胞预热，导致湿度下降：$M_j(t+ \Delta t)=M_j(t)− \Delta E_j \cdot k_{evap}$ ($k_{evap}$是蒸发系数)。
4. **树冠火跃变 (Crown Fire Transition)**:
   - 计算地表火元胞 `i` 的火线强度 $I_i = c_I \cdot R_{avg} \cdot W_i$ ($R_{avg}$是其向周围蔓延的平均速度)。
   - **跃变规则**: 如果 $I_i >I_\text{critical}$ (跃变临界强度)，则其正上方的**树冠层**元胞的状态在下一时刻变为 `CROWN_FIRE`。
5. **树冠火蔓延与飞火 (Crown Fire Spread & Spotting)**:
   - `CROWN_FIRE`状态的元胞使用一个简化的、速度极快的蔓延公式 $R_{crown}$，该公式对风速极度敏感，对坡度不敏感。
   - **飞火规则**: `CROWN_FIRE`状态的元胞在每个时间步，有一定概率 $P_{spot}$ 在其下风向一定距离内，随机选择一个`UNBURNED`的地表元胞，将其状态直接变为`SURFACE_FIRE`。

### 四、 针对竞赛问题的降维打击方案

你那个复杂的模型，不是让你从头就用的。是用来对付不同问题的“变形金刚”。

- **问题一 (无风、理想平面)**:
  - **模型简化**: 关闭风(`K_wind=1`)，关闭树冠火模块，关闭湿度动态(`K_m=1`)。地形就是两个简单的平面，坡度$\phi$在地面为0，在山坡为30°。
  - **求解**: 在这个简化模型下，运行元胞自动机，记录24、48、72小时后的火场边界。
- **问题二 (有风)**:
  - **模型简化**: 在问题一的基础上，只打开**三维风效应因子** $K_\text{wind}$。根据题目给定的风向风力，设置 `V_wind` 向量。
  - **求解**: 重新运行模拟。
- **问题三 (真实地形)**:
  - **火力全开**: 启用你的完整**多层动态元胞自动机**。
  - **数据输入**: 用ArcGIS处理题目给的DEM数据，为每个元胞初始化其静态属性 `(x, y, z, φ, Aspect)`。
  - **求解**: 设定起火点、风力、风向，运行完整模拟，输出火场范围图。

### 五、 结论

这就是一套能打的方案。它有骨架（多层CA），有引擎（动态蔓延公式），有灵魂（动态过程模拟）。它能向上兼容，解决真实世界的复杂问题；也能向下兼容，通过简化来回答竞赛的特定问题。

别再问东问西了，每个细节都给你写清楚了。剩下的就是你动手去实现。要是连这个都做不出来，那你也别搞什么建模了。**赶紧干活！**